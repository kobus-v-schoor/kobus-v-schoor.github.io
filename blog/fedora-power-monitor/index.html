<!doctype html><html lang=en>
<head>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-155995545-2','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta property="og:title" content="Auto-switching Fedora's power profile when plugging in your charger">
<meta property="og:description" content="A small script to automatically switch your power profile based on whether your laptop is charging or not">
<meta property="og:type" content="article">
<meta property="og:url" content="https://kobusvs.co.za/blog/fedora-power-monitor/"><meta property="article:section" content="blog">
<meta property="article:published_time" content="2021-12-09T07:25:03+00:00">
<meta property="article:modified_time" content="2021-12-09T10:56:45+02:00">
<link rel=icon type=image/svg+xml href=/img/favicon.svg>
<link rel=stylesheet href=/css/bootstrap.min.css>
<link rel=stylesheet href=https://kobusvs.co.za/scss/main.min.c94ad7431e3268ae410e15c818c27a1b6b95328608c8f62aea9723732c23df72.css>
<link rel=stylesheet href=https://kobusvs.co.za/scss/highlight.min.bacff1324e0b5d47142968eba7ff281719a11bfdf151acf99c88f948dadd156c.css>
<title>Auto-Switching Fedora's Power Profile When Plugging in Your Charger Â· Kobus van Schoor</title>
</head>
<body>
<nav class="d-md-none navbar navbar-expand flex-column navbar-dark text-light mobile-navbar">
<a href=https://kobusvs.co.za/ class=navbar-brand>
<img src=/img/mobile-logo.svg width=30 height=30>
Kobus van Schoor
</a>
<ul class="navbar-nav w-100 d-flex justify-content-around">
<li class="nav-item text-center">
<a class=nav-link href=https://kobusvs.co.za/>
<i data-feather=home></i>
<br>
Home
</a>
</li>
<li class="nav-item text-center">
<a class=nav-link href=https://kobusvs.co.za/resume/>
<i data-feather=file-text></i>
<br>
Resume
</a>
</li>
<li class="nav-item text-center">
<a class=nav-link href=https://kobusvs.co.za/tags/projects/>
<i data-feather=cpu></i>
<br>
Projects
</a>
</li>
<li class="nav-item text-center">
<a class=nav-link href=https://kobusvs.co.za/blog/>
<i data-feather=feather></i>
<br>
Blog
</a>
</li>
</ul>
</nav>
<div class=container-fluid>
<div class=row>
<nav class="d-none d-md-flex col-md-3 col-lg-2 flex-column align-items-start sidebar">
<div class="text-center mx-auto">
<a href=https://kobusvs.co.za/>
<img src=/img/logo.svg class="mt-3 desktop-logo">
</a>
<h5 class="align-self-center pt-3">Kobus van Schoor</h5>
</div>
<small class="align-self-center mb-3">
<i class=f-16 data-feather=map-pin></i>Pretoria, South Africa
</small>
<span class="align-self-center d-flex flex-row">
<a href=https://github.com/kobus-v-schoor/ class=social>
<i data-feather=github></i>
</a>
<a href=https://www.linkedin.com/in/kobus-van-schoor class=social>
<i data-feather=linkedin></i>
</a>
<a href=mailto:v.schoor.kobus@gmail.com class=social>
<i data-feather=mail></i>
</a>
</span>
<hr>
<a class=sidebar-link href=https://kobusvs.co.za/>
<i data-feather=home></i>
Home
</a>
<a class=sidebar-link href=https://kobusvs.co.za/resume/>
<i data-feather=file-text></i>
Resume
</a>
<a class=sidebar-link href=https://kobusvs.co.za/tags/projects/>
<i data-feather=cpu></i>
Projects
</a>
<a class=sidebar-link href=https://kobusvs.co.za/blog/>
<i data-feather=feather></i>
Blog
</a>
<small class="mt-auto align-self-center">
&copy; 2021 Kobus van Schoor
</small>
</nav>
<main class="col-md-9 col-lg-10">
<div class="container mt-3 mt-xl-5 mb-5">
<div class=row>
<article class=col-xl>
<h1>Auto-switching Fedora's power profile when plugging in your charger</h1>
<div class="text-muted d-flex flex-column flex-md-row">
<span class="d-flex align-items-center">
<i data-feather=calendar></i>9 Dec 2021
</span>
<span class="d-flex align-items-center ml-md-2">
<i data-feather=clock></i>2 minutes
</span>
</div>
<div class="mb-2 text-truncate text-muted">
<i data-feather=tag></i><a class=text-secondary href=https://kobusvs.co.za/tags/linux/>linux</a>, <a class=text-secondary href=https://kobusvs.co.za/tags/utilities/>utilities</a>
</div>
<hr>
<p>The new <code>power-profiles-daemon</code> present in Fedora 34 and up is fantastic, I&rsquo;ve
been been able to squeeze out a lot of extra battery life and performance by
switching the profiles. The only problem is the lack of support for
auto-switching the profile based on whether or not your laptop is currently
charging. Ideally, I wanted my laptop to go into performance mode when plugged
in, and when it goes on battery it should switch back to balanced mode.</p>
<p>To do this I wrote a little script that monitors the charging state of your
laptop, which then switches the power-profile whenever you plug or unplug it
from your charger. The script is started automatically when you log in using a
systemd user service. Before you&rsquo;ll be able to use this script you need to
install the <code>inotify-tools</code> package.</p>
<p>Copy the following script somewhere (I like using <code>~/.local/bin</code>), and make
sure that it is executable. You can adjust which power-profiles should be used
for the charging, discharging and low battery states by changing the values in
the <code>AC_PROFILE</code>, <code>BAT_PROFILE</code> and <code>LOW_BAT_PROFILE</code> variables, respectively.</p>
<script type=application/javascript src=https://gist.github.com/kobus-v-schoor/fd3b48eebfa40cc29f984a9b69b23ea4.js></script>
<p>Once you have the script stored somewhere and ready to execute, you can add the
following service file in your local systemd config folder, i.e.
<code>~/.config/systemd/user/power-monitor.service</code> (you might need to create the
folder). Be sure to update the <code>ExecStart</code> parameter to your script&rsquo;s path. You
can then enable and start the service using <code>systemctl --user enable --now power-monitor.service</code>.</p>
<script type=application/javascript src=https://gist.github.com/kobus-v-schoor/9df95c255fef52817176a49888d2ff62.js></script>
<p>That should be it. You can then monitor the script&rsquo;s operation using <code>systemctl --user status power-monitor.service</code>, you should be getting log entries when it
updates the power profile. The script will wait 30 seconds before starting up,
I&rsquo;ve found if I don&rsquo;t add this delay the power-profiles daemon will throw an
error when I log in (presumably because it is not yet ready).</p>
<hr>
<footer class=text-center>
<small class=text-muted>
<i data-feather=git-commit></i> 1038477
</small>
<small class="ml-2 text-muted">
<i data-feather=package></i> 0.91.2
</small>
</footer>
</article>
</div>
</div>
</main>
<span class="d-md-none text-muted text-center w-100">
&copy; 2021 Kobus van Schoor
</span>
</div>
</div>
<script src=/js/jquery-3.5.1.slim.min.js></script>
<script src=/js/bootstrap.bundle.min.js></script>
<script src=/js/feather.min.js></script>
<script>feather.replace()</script>
<script>var toc=$('#TableOfContents').children('ul').addClass('list-group');toc=toc.find('li').addClass('list-group-item'),toc=toc.find('a').addClass('text-dark')</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js></script>
</body>
</html>